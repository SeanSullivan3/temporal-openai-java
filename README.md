# README

This repository is a Java Spring Application that demonstrates how to use Temporal and OpenAI to build a simple chatbot. 
This project is inspired from Patrick Rachford's python based Flask application at [https://github.com/rachfop/temporal-openai](url) but instead using the Spring framework and Java.net to build the application in Java.
This application uses Temporal to ensure durable execution of our chatbot by implementing a workflow that uses an activity to call the OpenAI API to generate responses to user questions.

## Running the application

### Prerequisites:

- Java 17
- [Maven 4.0.0](https://maven.apache.org/download.cgi)
- [Local Temporal server running](https://docs.temporal.io/application-development/foundations#run-a-development-cluster)
- [Open AI keys](https://platform.openai.com/account/api-keys)

With this repository cloned, run the following at the root of the directory:

```Bash
mvn compile
```

### Steps to run the application
1. Start the Temporal server by running `temporal server start-dev`.  

2. In a new terminal window, save your openai key to the OPENAI_API_KEY environment variable by running  
&emsp;&emsp;`export OPENAI_API_KEY=YourSecretKey` for macOS  
&emsp;&emsp;OR  
&emsp;&emsp;`set OPENAI_API_KEY=YourSecretKey` for Windows  

3. Then in the same terminal window, start the worker by running `mvn compile exec:java -Dexec.mainClass="temporalOpenai.OpenaiWorker"`.  
   
4. In another terminal window, start the Spring application by running `mvn compile exec:java -Dexec.mainClass="temporalOpenai.Starter"`.  
   
5. Open your web browser and go to `http://localhost:8080`.  

## UI

Interact with the model with the Spring UI.


See the results from Temporal's Web UI at: <http://localhost:8233/>.  

## Files

### OpenaiActivities.java  ->  OpenaiActivitiesImpl.java

OpenaiActivitiesImpl is the implementation of the OpenActivities interface which defines the only activity in our workflow `getResponse()`.
This activity takes in a Question object as a parameter and returns a string representing openai's chatbot reponse.
This is achieved therough a http POST request of a json formatted string to api.openai.com through the Java.net framework.

### OpenaiWorkflow.java  ->  OpenaiWorkflowImpl.java

OpenaiWorkflowImpl is the implementation of the OpenaiWorkflow interface which outlines our workflow function `chat()`. 
Our workflow function accepts a question string and returns a response string by converting our question string to a Question object and passing it to our `getResponse()` activity, then returning the result. 

### Question.java

This file is a simple object to hold a question and an answer string. When using Temporal, it is reccomended to pass objects through activities, to improve backwards-compadability,
but this object also serves as an individual record for the chat history.

### Starter.java

This file defines a Spring application that serves as a user interface to the chatbot.
When the user submits a question, the application creates an instance of `OpenAIWorkflow` and executes it using the Temporal client.
The application then displays the user's question and the response generated by the chatbot.

### OpenaiWorker.java

This file starts the Temporal worker, which listens for and executes workflows and activities. It uses the `getResponse()` activity and the `OpenaiWorkflow` workflow.
